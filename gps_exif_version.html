<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë°°ìˆ˜êµ¬ ì‚¬ì§„ EXIF GPS ì¶”ì¶œ (EXIF ì „ìš©)</title>
  <!-- exif-js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 400px;
      margin: auto;
    }
    h2 {
      color: #222;
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    input[type="file"] {
      margin-bottom: 1rem;
    }
    #location {
      margin: 1rem 0;
      color: #555;
    }
    button {
      padding: 8px 12px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    button:disabled {
      background-color: #9e9e9e;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <h2>ğŸ“· ë°°ìˆ˜êµ¬ ì‚¬ì§„ì„ ì„ íƒí•´ ì£¼ì„¸ìš” (EXIF ì „ìš©)</h2>

  <!-- 1) íŒŒì¼ ì…ë ¥ (ì‚¬ì§„ ì—…ë¡œë“œ) -->
  <input
    type="file"
    accept="image/jpeg, image/jpg"
    id="photoInput"
  /><br />

  <!-- 2) EXIF GPS ê²°ê³¼ í‘œì‹œ -->
  <p id="location">ğŸ“ ì‚¬ì§„ ì† GPS ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>

  <!-- 3) (ì„ íƒ) ì „ì†¡ ë²„íŠ¼ -->
  <button id="sendButton" disabled>ğŸ“¤ ì‚¬ì§„ ì •ë³´ ì „ì†¡</button>

  <script>
    // ì „ì—­ ë³€ìˆ˜: ì¶”ì¶œëœ ìœ„ë„/ê²½ë„
    let extractedLat = null;
    let extractedLon = null;

    // EXIF GPS ì¢Œí‘œë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function convertDMSToDecimal(dmsArray, ref) {
      // dmsArray ì˜ˆ: [ [deg,1], [min,1], [sec,100] ]
      const deg = dmsArray[0][0] / dmsArray[0][1];
      const min = dmsArray[1][0] / dmsArray[1][1];
      const sec = dmsArray[2][0] / dmsArray[2][1] / 100; 
      let decimal = deg + (min / 60) + (sec / 3600);
      if (ref === "S" || ref === "W") {
        decimal = -decimal;
      }
      return decimal;
    }

    // íŒŒì¼ ì…ë ¥ ì´ë²¤íŠ¸: ì‚¬ìš©ìê°€ ì‚¬ì§„ì„ ì„ íƒí•˜ë©´ ì‹¤í–‰
    document
      .getElementById("photoInput")
      .addEventListener("change", function () {
        const file = this.files[0];
        if (!file) {
          document.getElementById("location").innerText =
            "â— ì‚¬ì§„ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
          document.getElementById("sendButton").disabled = true;
          return;
        }

        // EXIF ë°ì´í„° ì½ê¸° (exif-js)
        EXIF.getData(file, function () {
          // GPS íƒœê·¸ ì¶”ì¶œ
          const gpsLat = EXIF.getTag(this, "GPSLatitude");
          const gpsLatRef = EXIF.getTag(this, "GPSLatitudeRef");
          const gpsLon = EXIF.getTag(this, "GPSLongitude");
          const gpsLonRef = EXIF.getTag(this, "GPSLongitudeRef");

          if (
            gpsLat && gpsLatRef && gpsLon && gpsLonRef &&
            gpsLat.length === 3 && gpsLon.length === 3
          ) {
            // DMS â†’ 10ì§„ìˆ˜
            extractedLat = convertDMSToDecimal(gpsLat, gpsLatRef);
            extractedLon = convertDMSToDecimal(gpsLon, gpsLonRef);

            document.getElementById("location").innerText =
              `ğŸ“ ì‚¬ì§„ ì† ìœ„ì¹˜: ${extractedLat.toFixed(
                6
              )}, ${extractedLon.toFixed(6)}`;
            document.getElementById("sendButton").disabled = false;
          } else {
            // EXIFì— GPS ì •ë³´ê°€ ì—†ì„ ë•Œ
            document.getElementById("location").innerText =
              "âš ï¸ ì‚¬ì§„ì— GPS ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ì¹˜ íƒœê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
            extractedLat = null;
            extractedLon = null;
            document.getElementById("sendButton").disabled = true;
          }
        });
      });

    // (ì„ íƒ) ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
    document
      .getElementById("sendButton")
      .addEventListener("click", function () {
        const fileInput = document.getElementById("photoInput");
        const file = fileInput.files[0];
        if (!file || extractedLat === null || extractedLon === null) {
          alert("ğŸ“¸ ì˜¬ë°”ë¥¸ ì‚¬ì§„ê³¼ ìœ„ì¹˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
          return;
        }

        // FormDataì— ì‚¬ì§„ + ìœ„ì¹˜ ë°ì´í„° ì¶”ê°€
        const formData = new FormData();
        formData.append("photo", file);
        formData.append("latitude", extractedLat);
        formData.append("longitude", extractedLon);

        // ì˜ˆì‹œ: ì½˜ì†”ì— ì¶œë ¥ (ì›í•˜ëŠ” ì„œë²„ë¡œ POST ìš”ì²­ ì½”ë“œë¡œ ìˆ˜ì •)
        console.log("âœ… ì „ì†¡í•  ë°ì´í„°:");
        console.log("ì‚¬ì§„:", formData.get("photo"));
        console.log("ìœ„ë„:", formData.get("latitude"));
        console.log("ê²½ë„:", formData.get("longitude"));

        alert("ğŸ“¤ ì „ì†¡ ì™„ë£Œ (EXIF ê¸°ë°˜)");
      });
  </script>
</body>
</html>
